\documentclass[10pt]{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{geometry}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{physics}

\geometry{
    a4paper,
    left=20mm,
    right=20mm,
    top=20mm,
    bottom=20mm
}

% commands
\newcommand{\deq}{\vcentcolon=}
\newcommand{\idd}{\text{Ä‘}}
\newcommand{\nimplies}{\centernot\implies}
\newcommand{\vc}[1]{\boldsymbol{#1}}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\newcommand{\mat}[1]{\mathbf{#1}}
\newcommand{\hess}[1]{\vc{\nabla}^2 f(\vc{#1})}

\title{industrial p02 notes}
\author{cs}

\begin{document}

\maketitle

\section{Implementation Summary}

The provided notebook implements a spatial agent-based simulation on a
$100\times100$ lattice representing the topology of Edinburgh. The map incorporates
hard-coded geographic features, including parks (e.g., The Meadows), roads, and
fixed amenities (schools, gyms, shops). Agents are initialized with income levels
(derived from Scottish Index of Multiple Deprivation data) and heterogeneous
attributes including religion, language, and age category.

The simulation evolves through two coupled dynamic processes:

\begin{enumerate}
    \item \textbf{Price Evolution:} Housing prices $V$ at location $\mathbf{x}$
    are updated iteratively based on occupant income $A$ and the average price
    of the Moore neighborhood $\mathcal{N}(\mathbf{x})$:
    $$ V^{t+1}(\mathbf{x}) = V^t(\mathbf{x}) + A^t(\mathbf{x}) + \lambda
    \frac{\sum_{\mathbf{y}\in\mathcal{N}(\mathbf{x})}
    V^t(\mathbf{y})}{\#\mathcal{N}(\mathbf{x})} $$

    \item \textbf{Agent Mobility:} Unlike the vacancy-based model described in
    the text, the code utilizes pairwise swapping (Kawasaki dynamics). Two
    randomly selected grid cells $\mathbf{x}$ and $\mathbf{y}$ exchange
    occupants if the swap yields a positive net change in utility ($\Delta > 0$).
    The utility function balances economic affordability with social amenities:
    $$ \Delta = \Delta_{\text{money}} + \Delta_{\text{amenities}} $$
    where $\Delta_{\text{money}}$ minimizes the squared difference between
    household income and property price, and $\Delta_{\text{amenities}}$
    maximizes cultural similarity with neighbors (Schelling mechanism) and
    proximity to preferred facilities.
\end{enumerate}

\section{Entropy implementation}
To quantify segregation, we measure how ``mixed'' each neighbourhood is.
Let $i$ index a habitable cell, and let $N(i)$ be a square window of radius
$r$ around $i$.  Within this window, we compute the local proportions of the
two groups $g\in\{0,1\}$:
\[
p_{i,g}=\frac{\#\{j\in N(i):\text{group}(j)=g\}}{\#N(i)}.
\]
If a neighbourhood is fully mixed, these proportions are close to $1/2$; if
it is segregated, one of them is close to $1$ and the other close to $0$.

To convert these proportions into a single measure of ``local disorder'', we
use the Shannon entropy:
\[
H_i=-\sum_{g}p_{i,g}\,\ln p_{i,g}, \qquad 0\ln 0:=0.
\]
Entropy is maximised when both groups are equally present, and minimised
when one group dominates.  For two groups, the maximum entropy is $\ln 2$,
so we define a normalised entropy:
\[
\tilde H_i=\frac{H_i}{\ln 2}\in[0,1].
\]
Here $\tilde H_i\approx 1$ means a well-mixed neighbourhood, while
$\tilde H_i\approx 0$ indicates homogeneity.

To obtain a city-wide measure, we average $\tilde H_i$ over all habitable
cells $\mathcal H$:
\[
\tilde H_{\text{mean}}=\frac{1}{|\mathcal H|}\sum_{i\in\mathcal H}\tilde H_i.
\]
Finally, because segregation corresponds to *low* entropy, we define the
segregation index
\[
S=1-\tilde H_{\text{mean}}, \qquad S\in[0,1].
\]
Thus $S=0$ denotes a perfectly mixed configuration, while $S=1$ denotes a
perfectly segregated configuration.

\newpage

\textbf{Implementation summary of $sch_{002}$}

\section{Environment Initialization}
The simulation environment is discretized into an $N \times M$ grid 
($100 \times 100$), represented by variables \texttt{N} and \texttt{M}. Each 
cell is classified via a \texttt{city\_mask} as \texttt{RESIDENTIAL}, 
\texttt{PARK}, \texttt{AMENITY}, or \texttt{EMPTY}.

\subsection{Topology Generation}
The map topology approximates Edinburgh using vectorized geometric constraints. 
Parks are defined by boolean unions of rotated ellipses:
\begin{equation}
    \left(\frac{x'}{r_x}\right)^2 + \left(\frac{y'}{r_y}\right)^2 \leq 1
\end{equation}
implemented in the helper \texttt{rotated\_oval}. Roads are defined by linear 
inequalities. Static amenity scores ($A_{i,j}$) are precomputed by convolving 
binary amenity locations with an inverse-distance kernel $K(d) = (1+d)^{-1}$, 
stored in \texttt{amenity\_scores}.

\subsection{Agent Properties}
Habitable cells are populated with agents possessing:
\begin{itemize}
    \item \textbf{Income ($I$):} Drawn from \texttt{INCOME\_VALUES} 
    $\{0.1, 0.5, 1.0\}$ with probability distribution \texttt{INCOME\_PROBS}.
    \item \textbf{Group ($g$):} Binary classification stored in 
    \texttt{groups}, initialized with a 70/30 split.
    \item \textbf{Price ($P$):} Initialized proportional to income plus 
    Gaussian noise, stored in \texttt{prices}.
\end{itemize}

\section{System Dynamics}
The simulation proceeds for \texttt{NUM\_STEPS} iterations. Each step involves 
economic updates and agent relocation attempts.

\subsection{Price Evolution}
Housing prices evolve based on intrinsic agent income and the average price of 
the Moore neighborhood ($\mathcal{N}$). The update rule in 
\texttt{update\_prices} is:
\begin{equation}
    P_{t+1} = P_t + I + \lambda \cdot \langle P \rangle_{\mathcal{N}}
\end{equation}
where $\lambda$ corresponds to \texttt{LAMBDA\_PRICE} ($0.01$). This simulates 
gentrification where high-income neighbors drive up local property values.

\subsection{Agent Relocation (Swaps)}
In \texttt{attempt\_moves}, we randomly sample pairs of agents at locations 
$x$ and $y$. A swap occurs if the utility change is favorable. The utility 
change $\Delta U$ considers financial, amenity, and social factors.

The financial incentive ($\Delta M$), stored as \texttt{d\_money}, prevents 
poorer agents from moving to expensive areas:
\begin{equation}
    \Delta M = 2 (P_x - P_y)(I_x - I_y)
\end{equation}
Amenity gain is the difference in static scores $A$. The social score $H$ 
(homophily) is the fraction of similar neighbors, calculated via 
\texttt{get\_social\_score}. A swap is executed if financial feasibility is 
met ($\Delta M > -500$) and the combined utility increases.

\section{Metrics: Segregation Entropy}
Segregation is measured using spatial Shannon entropy in 
\texttt{segregation\_entropy}. For a local neighborhood with proportion $p$ of 
group 1, the local entropy is:
\begin{equation}
    H_{local} = - \sum_{g \in \{0,1\}} p_g \log_2(p_g)
\end{equation}
The global segregation index $S$ is defined as $1 - \bar{H}_{local}$, where 
$\bar{H}$ is the mean entropy over habitable cells.

\end{document}
